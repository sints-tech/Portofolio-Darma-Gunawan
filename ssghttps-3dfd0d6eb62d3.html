var t=["x","y","z"],e=function(t){Object.assign(this,{uniforms:{},geometry:{vertices:[{x:0,y:0,z:0}]},mode:0,modifiers:{},attributes:[],multiplier:1,buffers:[]}),Object.assign(this,t),this.prepareProgram(),this.prepareUniforms(),this.prepareAttributes()};e.prototype.compileShader=function(t,r){var
s=this.gl.createShader(t);return this.gl.shaderSource(s,r),this.gl.compileShader(s),s},e.prototype.prepareProgram=function(){var t=this.gl,r=this.vertex,s=this.fragment,n=t.createProgram();t.attachShader(n,this.compileShader(35633,r)),t.attachShader(n,this.compileShader(35632,s)),t.linkProgram(n),t.useProgram(n),this.program=n},e.prototype.prepareUniforms=function(){for(var
t=Object.keys(this.uniforms),r=0;r<t.length;r+=1){var s=this.gl.getUniformLocation(this.program,t[r]);this.uniforms[t[r]].location=s}},e.prototype.prepareAttributes=function(){void 0!==this.geometry.vertices&&this.attributes.push({name: "aPosition",size:3}),void
    0!==this.geometry.normal&&this.attributes.push({name: "aNormal",size:3}),this.attributeKeys=[];for(var t=0;t<this.attributes.length;t+=1)this.attributeKeys.push(this.attributes[t].name),this.prepareAttribute(this.attributes[t])},e.prototype.prepareAttribute=function(r){for(var
    s=this.geometry,n=this.multiplier,a=s.vertices,o=s.normal,h=new Float32Array(n*a.length*r.size),u=0;u<n;u+=1)for(var f=r.data&&r.data(u,n),c=u*a.length*r.size,l=0;l<a.length;l+=1)for(var p=0;p<r.size;p+=1){var m=this.modifiers[r.name];h[c]=void 0!==m?m(f,l,p,this):
    "aPosition"===r.name?a[l][t[p]]: "aNormal"===r.name?o[l][t[p]]:f[p],c+=1}this.attributes[this.attributeKeys.indexOf(r.name)].data=h,this.prepareBuffer(this.attributes[this.attributeKeys.indexOf(r.name)])},e.prototype.prepareBuffer=function(t){var r=t.data,s=t.name,n=t.size,a=this.gl.createBuffer();this.gl.bindBuffer(34962,a),this.gl.bufferData(34962,r,35044);var
    o=this.gl.getAttribLocation(this.program,s);this.gl.enableVertexAttribArray(o),this.gl.vertexAttribPointer(o,n,5126,!1,0,0),this.buffers[this.attributeKeys.indexOf(t.name)]={buffer:a,location:o,size:n}},e.prototype.render=function(t){var r=this,s=this.uniforms,n=this.multiplier,a=this.gl;a.useProgram(this.program);for(var
    o=0;o<this.buffers.length;o+=1){var h=this.buffers[o],u=h.location,f=h.buffer,c=h.size;a.enableVertexAttribArray(u),a.bindBuffer(34962,f),a.vertexAttribPointer(u,c,5126,!1,0,0)}Object.keys(t).forEach((function(r){s[r].value=t[r].value})),Object.keys(s).forEach((function(t){var
    n=s[t];r.uniformMap[n.type](n.location,n.value)})),a.drawArrays(this.mode,0,n*this.geometry.vertices.length),this.onRender&&this.onRender(this)},e.prototype.destroy=function(){for(var t=0;t<this.buffers.length;t+=1)this.gl.deleteBuffer(this.buffers[t].buffer);this.gl.deleteProgram(this.program),this.gl=null};var
    i=function(t){var r=this,s=t||{},n=s.canvas;void 0===n&&(n=document.querySelector( "canvas"));var a=s.context;void 0===a&&(a={});var o=s.contextType;void 0===o&&(o="experimental-webgl" );var h=s.settings;void 0===h&&(h={});var u=n.getContext(o,Object.assign({alpha:!1,antialias:!1},a));Object.assign(this,{gl:u,canvas:n,uniforms:{},instances:new
    Map,shouldRender:!0}),Object.assign(this,{devicePixelRatio:1,clearColor:[1,1,1,1],position:{x:0,y:0,z:2},clip:[.001,100]}),Object.assign(this,h),this.uniformMap={float:function(t,r){return u.uniform1f(t,r)},vec2:function(t,r){return u.uniform2fv(t,r)},vec3:function(t,r){return
    u.uniform3fv(t,r)},vec4:function(t,r){return u.uniform4fv(t,r)},mat2:function(t,r){return u.uniformMatrix2fv(t,!1,r)},mat3:function(t,r){return u.uniformMatrix3fv(t,!1,r)},mat4:function(t,r){return u.uniformMatrix4fv(t,!1,r)}},u.enable(u.DEPTH_TEST),u.depthFunc(u.LEQUAL),!1===u.getContextAttributes().alpha&&(u.clearColor.apply(u,this.clearColor),u.clearDepth(1)),this.onSetup&&this.onSetup(u),window.addEventListener(
    "resize",(function(){return r.resize()})),this.resize(),this.render()};i.prototype.resize=function(){var t=this.gl,r=this.canvas,s=this.devicePixelRatio,n=this.position;r.width=r.clientWidth*s,r.height=r.clientHeight*s;var a=t.drawingBufferWidth,o=t.drawingBufferHeight,h=a/o;t.viewport(0,0,a,o);var
    u=Math.tan(Math.PI/180*22.5),f=[1,0,0,0,0,1,0,0,0,0,1,0,n.x,n.y,(h<1?1:h)*-n.z,1];this.uniforms.uProjectionMatrix={type: "mat4",value:[.5/u,0,0,0,0,h/u*.5,0,0,0,0,-(this.clip[1]+this.clip[0])/(this.clip[1]-this.clip[0]),-1,0,0,-2*this.clip[1]*(this.clip[0]/(this.clip[1]-this.clip[0])),0]},this.uniforms.uViewMatrix={type:
    "mat4",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},this.uniforms.uModelMatrix={type: "mat4",value:f}},i.prototype.toggle=function(t){t!==this.shouldRender&&(this.shouldRender=void 0!==t?t:!this.shouldRender,this.shouldRender&&this.render())},i.prototype.render=function(){var
    t=this;this.gl.clear(16640),this.instances.forEach((function(r){r.render(t.uniforms)})),this.onRender&&this.onRender(this),this.shouldRender&&requestAnimationFrame((function(){return t.render()}))},i.prototype.add=function(t,r){void 0===r&&(r={uniforms:{}}),void
    0===r.uniforms&&(r.uniforms={}),Object.assign(r.uniforms,JSON.parse(JSON.stringify(this.uniforms))),Object.assign(r,{gl:this.gl,uniformMap:this.uniformMap});var s=new e(r);return this.instances.set(t,s),s},i.prototype.remove=function(t){var r=this.instances.get(t);void
    0!==r&&(r.destroy(),this.instances.delete(t))},i.prototype.destroy=function(){var t=this;this.instances.forEach((function(r,s){r.destroy(),t.instances.delete(s)})),this.toggle(!1)};export default i; //# sourceMappingURL=phenomenon.mjs.map